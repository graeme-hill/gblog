<!DOCTYPE html>
<html>
	<head>
		<title>LINQ to SQL Gotcha #4: ChangeConflictException on Update of Manually Attached Data</title>
		<link rel="stylesheet" type="text/css" href="/resources/css/style.css">
	</head>

	<body>
		<div id="div_header">
			<h1><a href="/">Graeme Hill's Dev Blog</a></h1>
		</div>

		<div id="div_content">
			<div class="div_article">
	<div class="div_article_header">
		<h1><a href="/linq-to-sql-gotcha-4-changeconflictexception-on-update-of-manually-attached-data">LINQ to SQL Gotcha #4: ChangeConflictException on Update of Manually Attached Data</a></h1>
		<p>2010.040</p>
	</div>
	<div class="div_article_content">
		<p>title: LINQ to SQL Gotcha #4: ChangeConflictException on Update of Manually Attached Data
labels: .NET, LINQ, LINQ to SQL, SQL Server</p>

<p>LINQ to SQL has built in <a href="http://en.wikipedia.org/wiki/Optimistic_concurrency_control">optimistic concurrency</a> checking.  When you create an unattached entity and then attach it (ie: with the <code>Attach()</code> function) the concurrency check will always fail by throwing a <code>ChangeConflictException</code> unless one of the two are true<!--break-->:</p>

<ul>
<li>The table that the entity belongs to has a timestamp column and its value is exactly the same as it appears in the database.</li>
<li>There is no timestamp column but the "no count" feature on SQL Server is <em>off</em>.
</ul>

<p>Using a timestamp column seems like the more elegant solution, but it does require that you know the timestamp value.  This usually means that if you're attaching the result of a stored procedure so that you can save back the results, your stored procedure needs to return the timestamp in addition to the primary key.</p>

	</div>
</div>
		</div>
	</body>
</html>