<!DOCTYPE html>
<html>
	<head>
		<title>EFTracingConnection and CreateDbCommand</title>
		<link rel="stylesheet" type="text/css" href="/resources/css/style.css">
	</head>

	<body>
		<div id="div_header">
			<h1><a href="/">Graeme Hill's Dev Blog</a></h1>
		</div>

		<div id="div_content">
			<div class="div_article">
	<div class="div_article_header">
		<h1><a href="/eftracingconnection-and-createdbcommand">EFTracingConnection and CreateDbCommand</a></h1>
		<p>2013.034</p>
	</div>
	<div class="div_article_content">
		<p>I've been using the <code>EFTracingConnection</code> class that comes as a part of the <a href="http://efwrappers.codeplex.com/">Entity Framework Provider Wrappers</a> project. It works wonderfully well for tracking the SQL queries that get executed with the Entity Framework <code>DbContext</code> but I ran into a snag when I combined it with the <a href="https://github.com/loresoft/EntityFramework.Extended">EntityFramework.Extended</a> library for batch operations. I started getting a <code>NotSupportedException</code> whenever I tried to execute a batch operation with the tracing connection enabled. It turns out the EntityFramework.Extended internally uses <code>DbConnection.CreateDbCommand()</code> to run its SQL. However, the <code>EFTracingConnection</code> implementation does not implement that method since it acts as a wrapper for <code>DbConnection</code> even though it also inherits from it (ie: <code>EFTracingConnection</code> <em>has a</em> <code>DbConnection</code> even though it also <em>is a</em> <code>DbConnection</code>). The fix is to make a subclass of <code>EfTracingConnection</code> and implement the method by invoking it on the wrapped object:</p>

<pre><code>public class MyTracingConnection : EFTracingConnection
{
    protected override System.Data.Common.DbCommand CreateDbCommand()
    {
        return this.WrappedConnection.CreateCommand();
    }
}
</code></pre>

<p>So far this seems to work like a charm.</p>

	</div>
</div>
		</div>

		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-3499720-4']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
	</body>
</html>